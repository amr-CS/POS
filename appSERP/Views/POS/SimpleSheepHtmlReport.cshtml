@using System.Data;

@{
    ViewBag.Title = "حركة الذبائح";
    Layout = "~/Views/Shared/appLayout/_LayoutReport.cshtml";
    DataTable Data = ViewBag.vDT;
    if (Data == null)
    {
        <table class="tblitem" dir="rtl" style="margin-right:15px;width:100%">
            <tr>
                <td style="text-align: center; vertical-align: middle; font-weight:bolder;color:darkred;font-size:larger">
                    لا يوجد بيانات حسب بيانات البحث الحالية
                </td>
            </tr>
        </table>

        return;
    }

    double Total = 0;
    double TotalQty = 0;
    var GroupData = Data.AsEnumerable().Select(x => new { col1 = x["CategoryId"], col2 = x["CategoryName"] }).ToList().Distinct();
}


@foreach (var i in GroupData)
{
    double GroupTotal = 0;
    double GroupTotalQty = 0;
    double GroupTotalq = 0;
    <div style="float:right">
        الفئة
        :
        @i.col2.ToString()
    </div>
    <table class="tblitem" dir="rtl" style="margin-right:15px;width:100%">
        <thead style="">
            <tr>
                <th>رقم الطلب</th>
                <th>اسم العميل </th>

                <th width="30%">اسم الصنف</th>
                <th>الكمية</th>
                <th>الوحدة</th>
                <th>المبلغ </th>
                <th>الاجمالي </th>
            </tr>
        </thead>
        @if (Data != null)
        {

            foreach (DataRow item in Data.Rows)
            {
                if (i.col2.ToString() == item["CategoryName"].ToString())
                {
                    double TotalRow = Convert.ToDouble(item["Price"].ToString());
                    double qty = Convert.ToDouble(item["Qty"].ToString());

                    <tr>
                        <td style="text-align: center; vertical-align: middle;">
                            @item["OrderId"]
                            <br />
                        </td>
                        <td style="text-align: center; vertical-align: middle;padding-right:20px">
                            @item["CustomerNameL1"]
                        </td>
                        <td style="text-align:center; vertical-align: middle; ">
                            @item["InvItemNameL1"]

                        </td>

                        <td style="text-align:center; vertical-align: middle; ">
                            @item["Qty"]

                        </td>


                        <td style="text-align: center; vertical-align: middle;">
                            @item["LookupDtlDesc"]

                        </td>
                        <td style="text-align: center; vertical-align: middle;">@item["Price"]</td>
                        <td style="text-align: center; vertical-align: middle;">@(TotalRow * qty)</td>

                    </tr>

                    TotalQty = TotalQty + qty;
                    Total = Total + (TotalRow * qty);
                    GroupTotalQty = GroupTotalQty + qty;
                    GroupTotal = GroupTotal + TotalRow;
                    GroupTotalq = GroupTotalq + (TotalRow * qty);
                }
            }
        }
        <tr class="total">
            <td style="text-align: center;font:bold; vertical-align: middle;">
                الاجمالي  :
                <br />
            </td>
            <td style="text-align: center; vertical-align: middle;padding-right:20px">
            </td>

            <td style="text-align: center; vertical-align: middle;">
            </td>

            <td style="text-align:center;vertical-align: middle;">
                @Math.Round(GroupTotalQty, 2, MidpointRounding.ToEven)

            </td>
            <td style="text-align: center; vertical-align: middle;">
            </td>

            <td style="text-align: center; vertical-align: middle;">
                @Math.Round(GroupTotal, 2, MidpointRounding.ToEven)

            </td>
            <td style="text-align: center; vertical-align: middle;">
                @Math.Round(GroupTotalq, 2, MidpointRounding.ToEven)

            </td>

        </tr>
    </table>


}
<table class="tblitem" dir="rtl" style="margin-right:15px;width:100%">
    <thead>

    </thead>
    <tbody>
        <tr class="total">
            <td style="text-align: center;font:bold; vertical-align: middle;" width="30%">

                الكلي
                :
                <br />
            </td>
            <td style="text-align: center; vertical-align: middle;padding-right:20px">
            </td>
            <td style="text-align: center; vertical-align: middle;padding-right:20px">
            </td>
            <td style="text-align:center;vertical-align: middle;">
                @Math.Round(TotalQty, 2, MidpointRounding.ToEven)

            </td>
            <td style="text-align: center; vertical-align: middle;">
            </td>
            <td style="text-align: center; vertical-align: middle;">
            </td>
            <td style="text-align: center; vertical-align: middle;">
                @Math.Round(Total, 2, MidpointRounding.ToEven)

            </td>

        </tr>
    </tbody>
</table>

