

@using System.Data;

@{
    ViewBag.Title = "تقرير الوجبات";

    Layout = "~/Views/Shared/appLayout/_LayoutReport.cshtml";
    DataTable Data = ViewBag.vDT;

    double Total = 0;

    var GroupData = Data.AsEnumerable().Select(x => new { col1 = x["InvItemId"], col2 = x["InvItemCode"], col3 = x["InvItemNameL1"], col4 = x["DefaultUnitName"] }).ToList().Distinct();
}


<table class="tblitem" dir="rtl" style="margin-right:15px;width:100%">
    <thead style="">
        <tr>
            <th>الكود</th>
            <th width="30%">اسم الصنف</th>
            <th>السعر</th>
            <th>التكلفة</th>
            <th> نسبة التكلفة</th>

        </tr>
    </thead>

    @foreach (var i in GroupData)
    {
        double GroupTotal = 0;
        double CostTotal = 0;


        if (Data != null)
        {

            foreach (DataRow item in Data.Rows)
            {
                if (i.col1.ToString() == item["InvItemId"].ToString())
                {

                    double TotalRow = Convert.ToDouble(item["Price"]);
                    double CostRow = Convert.ToDouble(item["Cost"]);

                    @*<tr>
                        <td style="text-align: center; vertical-align: middle;">
                            @item["ContentCode"]
                            <br />
                        </td>
                        <td style="text-align: center; vertical-align: middle;">
                            @item["ContentName"]
                            <br />
                        </td>

                        <td style="text-align:center; vertical-align: middle; ">
                            @item["price"].ToString()
                        </td>

                        <td style="text-align:center; vertical-align: middle; ">
                            @item["Cost"].ToString()

                        </td>

                    </tr>*@
                GroupTotal = GroupTotal + TotalRow;
                CostTotal = CostTotal + CostRow;
            }
        }
    }
    double c = 0;
<tr class="total">
    <td style="text-align: center;font:bold; vertical-align: middle;">
        @i.col2.ToString()
        <br />
    </td>
    <td style="text-align: center; vertical-align: middle;padding-right:20px">
        @i.col3.ToString()
    </td>

    <td style="text-align:center;vertical-align: middle;">
        @Math.Round(GroupTotal, 2, MidpointRounding.ToEven)
    </td>
    <td style="text-align: center; vertical-align: middle;padding-right:20px">
        @Math.Round(CostTotal, 2, MidpointRounding.ToEven)
    </td>
    <td style="text-align: center; vertical-align: middle;padding-right:20px">
        @if (GroupTotal > 1) {
         c=   Math.Round((CostTotal / GroupTotal) * 100, 2, MidpointRounding.ToEven);
        }
       @c  %
    </td>
</tr>

    }
</table>

