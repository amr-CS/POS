@using System.Data;

@{
    ViewBag.Title = "حسب المخزن تقرير الكميات في المخازن";

    Layout = "~/Views/Shared/appLayout/_LayoutReport.cshtml";
    DataTable Data = ViewBag.vDT;

    double Total = 0;
    double TotalSales = 0;
    double TotalCost = 0;
    double TotalVatTotal = 0;
    var GroupData =Data.AsEnumerable().Select(x => new { col1 = x["StoreId"], col2 = x["StoreNameL1"] }).ToList().Distinct();
}

@foreach (var i in GroupData)
{
    double GroupTotal = 0;
    double GroupTotalSales = 0;
    double GroupTotalCost = 0;
    double GroupTotalVat = 0;
    <div style="float:right">
        الفئة
        :
        @i.col2.ToString()
    </div>
    <table class="tblitem" dir="rtl" style="margin-right:15px;width:100%">
        <thead style="">
            <tr>
                <th>المخزن </th>
                <th>رقم الصنف </th>
                <th width="30%">اسم الصنف</th>
                <th>الكمية</th>
                <th>الوحدة </th>
                <th>التكلفة </th>
                <th>اجمالي التكلفة</th>
            </tr>
        </thead>
        @if (Data != null)
        {

            foreach (DataRow item in Data.Rows)
            {
                if (i.col1.ToString() == item["StoreId"].ToString())
                {
                    double TotalRow = (Convert.ToDouble(item["ItemOpenCost"].ToString()) * Convert.ToDouble(item["ItemQty"].ToString()));
                    <tr>
                        <td style="text-align: center; vertical-align: middle;">
                            @item["StoreNameL1"]

                        </td>
                        <td style="text-align: center; vertical-align: middle;">
                            @item["InvItemCode"]
                            <br />
                        </td>
                        <td style="text-align: center; vertical-align: middle;padding-right:20px">
                            @item["InvItemNameL1"]
                        </td>
                        <td style="text-align:center; vertical-align: middle; ">
                            @item["ItemQty"]

                        </td>

                        <td style="text-align:center; vertical-align: middle; ">
                            @item["UnitName"]

                        </td>
                        <td style="text-align: center; vertical-align: middle;">
                            @item["ItemOpenCost"]
                        </td>
                        <td style="text-align: center; vertical-align: middle;">
                            @Math.Round(TotalRow, 2, MidpointRounding.ToEven)

                        </td>
                    </tr>

                    Total = Total + TotalRow;
                   

                  
                    GroupTotal = GroupTotal + TotalRow;
                }
            }
        }
        <tr class="total">
            <td style="text-align: center;font:bold; vertical-align: middle;">
                الاجمالي  :
                <br />
            </td>
            <td style="text-align: center; vertical-align: middle;padding-right:20px">
            </td>

            <td style="text-align: center; vertical-align: middle;">
            </td>

            <td style="text-align:center;vertical-align: middle;">

            </td>
            <td style="text-align: center; vertical-align: middle;">
            </td>

            <td style="text-align: center; vertical-align: middle;">

            </td>
            <td style="text-align: center; vertical-align: middle;">
                @Math.Round(GroupTotal, 2, MidpointRounding.ToEven)

            </td>
        </tr>
    </table>


}
<table class="tblitem" dir="rtl" style="margin-right:15px;width:100%">
    <thead>

    </thead>
    <tbody>
        <tr class="total">
            <td style="text-align: center;font:bold; vertical-align: middle;" width="30%">

                الكلي
                :
                <br />
            </td>
            <td style="text-align: center; vertical-align: middle;padding-right:20px">
            </td>
            <td style="text-align: center; vertical-align: middle;padding-right:20px">
            </td>
            <td style="text-align:center;vertical-align: middle;">

            </td>
            <td style="text-align: center; vertical-align: middle;">
            </td>

            <td style="text-align: center; vertical-align: middle;">

            </td>
            <td style="text-align: center; vertical-align: middle;padding-left:30px">
                @Math.Round(Total, 2, MidpointRounding.ToEven)

            </td>
        </tr>
    </tbody>
</table>

