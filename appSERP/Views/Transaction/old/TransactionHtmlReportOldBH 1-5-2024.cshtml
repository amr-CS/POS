@using System.Data;

@{
    ViewBag.Title = "حركة المخزون";
    Layout = "~/Views/Shared/appLayout/_LayoutReport.cshtml";
    DataTable Data = ViewBag.vDT;
    double CurrentQty = 0;
    double CurrentPrice = 0;
    if (Data != null)
    {
        DataRow DRow = Data.Rows[0];
    }
    double Total = 0;
    double TotalSales = 0;
    double TotalVatTotal = 0;

    var GroupData = Data.AsEnumerable().Select(x => new { StoreId = x["StoreId"], StoreName = x["StoreName"], Category = x["Category"] }).ToList().Distinct();
}

@foreach (var i in GroupData)
{
    double TotalPriceOpenBlanace = 0;
    double TotalWaredPrice = 0;
    double TotalSaderPrice = 0;
    // string DefaultUnitName = i.DefaultUnitName.ToString();




    <div class="row" style="float:right">

        المخزن
        :
        @i.StoreName.ToString()
    </div>
    <br />
    <div class="row" style="float:right">

        النوع
        :
        @i.Category.ToString()
    </div>
    <br />

    <table class="tblitem" dir="rtl" style="margin-right:15px;width:100%">
        <thead>
            <tr>
                <th colspan="3"> اسم الصنف</th>
                <th colspan="2"> الرصيد الافتتاحي</th>
                <th colspan="2">الوارد</th>
                <th colspan="2">الصادر</th>
                <th colspan="2">الرصيد الحالي</th>
            </tr>
            <tr>
                <th> رقم الصنف</th>
                <th>اسم الصنف</th>
                <th>الوحدة</th>


                <th> الكمية</th>
                <th>القيمة</th>

                <th>الكمية</th>
                <th>القيمة</th>

                <th>الكمية</th>
                <th>القيمة</th>

                <th>الكمية</th>
                <th>القيمة</th>
            </tr>
        </thead>
        <tbody>
            @if (Data != null)
            {
                foreach (DataRow item in Data.Rows)
                {
                    if (i.Category.ToString() == item["Category"].ToString() && i.StoreId.ToString() == item["StoreId"].ToString())
                    {

                        double PriceOpenBlanace = (Convert.ToDouble(item["PriceOpenBlanace"]));
                        double WaredPrice = (Convert.ToDouble(item["WaredPrice"]));
                        double SaderPrice = (Convert.ToDouble(item["SaderPrice"]));
                        double WaredQty = (Convert.ToDouble(item["WaredQty"]));
                        double SaderQty = (Convert.ToDouble(item["SaderQty"]));
                        double QtyOpenBlanace = (Convert.ToDouble(item["QtyOpenBlanace"]));

                        <tr style="text-align: center">
                            <td> @item["InvItemCode"].ToString()</td>
                            <td>@item["InvItemNameL1"].ToString()</td>
                            <td>@item["DefaultUnitName"].ToString()</td>
                            <td>@item["QtyOpenBlanace"].ToString()</td>
                            <td>@item["PriceOpenBlanace"].ToString()</td>

                            <td> @item["WaredQty"].ToString()</td>
                            <td>@item["WaredPrice"].ToString()</td>

                            <td>@item["SaderQty"].ToString()</td>
                            <td>@item["SaderPrice"].ToString()</td>



                            <td>@(QtyOpenBlanace+WaredQty-SaderQty)</td>
                            <td>@(PriceOpenBlanace+WaredPrice-SaderPrice)</td>

                        </tr>
                        TotalPriceOpenBlanace = TotalPriceOpenBlanace + PriceOpenBlanace;
                        TotalSaderPrice = TotalSaderPrice + SaderPrice;
                        TotalWaredPrice = TotalWaredPrice + WaredPrice;
                    }


                }
                <tr class="total" style="text-align: center">

                <td colspan="3">الاجمالي </td>
                <td colspan="2"> @TotalPriceOpenBlanace</td>
                <td colspan="2">@TotalWaredPrice</td>
                <td colspan="2">@TotalSaderPrice</td>
                <td colspan="2">@(TotalPriceOpenBlanace+TotalWaredPrice-TotalSaderPrice)</td>



            </tr>

            }
        </tbody>
    </table>


}
----------------------------------------------
