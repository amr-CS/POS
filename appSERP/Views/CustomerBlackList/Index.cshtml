@using appSERP.appCode.Setting.User
@using appSERP.Views.Shared.appResource
@using appSERP.appCode.SQL.QueryType;
<!-- Header -->

<style>
    body {
        font-family: Cairo;
    }

    .fullHeightInput {
        height: 50px;
    }

    .table th, .table td {
        font-size: 12px;
        text-align: center;
    }

    .table th {
        margin: auto;
        border: none !important;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
    }

    .table th, .table td {
        padding: 0rem !important;
        vertical-align: top;
        border-top: 1px solid #dee2e6;
    }


    .tblHead {
        border-bottom: 1px solid #d4d4d4;
        margin-bottom: 0.5rem;
    }

    input, select, textarea {
        max-width: 100% !important;
    }

    textarea {
        max-width: 100% !important;
    }

    .form-inline {
        margin-top: 0.5rem;
    }

    .table td, .table th {
        border-top: 0 !important;
    }


    /* Special Classes */
    .controlRow {
        margin-top: 0.5rem;
    }

    .checkInput {
        margin: auto;
    }

    .tblFooter {
        border: 0 !important;
    }

    .tooltip > .tooltip-inner {
        background-color: #2980b9;
    }

    .tooltip > .tooltip-arrow {
        border-bottom-color: #2980b9;
    }

    .form-control:disabled, .form-control[disabled] {
        background-color: #eef1f5;
        opacity: 1;
    }

    .divGlVoucher {
        max-height: 50vh !important;
        overflow-y: scroll !important;
        background-color: #FFF;
    }

    .divCashblackList, .divChkStat {
        background-color: #eef1f5;
        padding: 5px;
        border: 1px solid #d4d4d4;
        border-radius: 3px;
    }

    .errorClass {
        border: 1px solid red;
    }
</style>
<!-- Head -->
<div class="bg-white border rounded p-3">
    <div class="row w-100 ">
        <div class="col-lg-1">
            <label class="font-weight-bold pt-3">
               القائمه السوداء
            </label>
        </div>
        <div class="d-flex justify-content-end col-lg-11">
            <div class="btn-group m-2" role="group" aria-label="First group">
                <!-- Save -->
                <button class="btn btnUtility btnSave" title="@appResource.btnSave"><i class="fa fa-save"></i></button>
                <button class="btn btnUtility btnSearch" title="@appResource.btnSearch"><i class="fa fa-search"></i></button>

            </div>
            <div class="btn-group m-2" role="group" aria-label="First group">
                <!-- Copy -->
                <button class="btn btnUtility btnCopy" title="@appResource.ttCopy"><i class="fa fa-copy"></i></button>
                <!-- Cut -->
                <button class="btn btnUtility btnCut" title="@appResource.ttCut"><i class="fa fa-cut"></i></button>
                <!-- Paste -->
                <button class="btn btnUtility btnPaste" title="@appResource.ttPaste"><i class="fa fa-paste"></i></button>
            </div>


            <div class="btn-group m-2" role="group" aria-label="First group">
                <!-- Print -->
                <button class="btn btnUtility btnPrint btnDataTablePrint" title="@appResource.ttPrint "><i class="fa fa-print"></i></button>
                <!-- Sort Asc -->
                <button class="btn btnUtility btnSortAsc" title="@appResource.ttSortAsc"><i class="fa fa-sort-asc"></i></button>
                <!-- Sort Desc -->
                <button class="btn btnUtility btnSortDesc" title="@appResource.ttSortDesc"><i class="fa fa-sort-desc"></i></button>
            </div>

            <div class="btn-group m-2" role="group" aria-label="First group">
                <!-- ADD -->
                <button class="btn btnUtility" title="@appResource.ttAdd"><i class="fa fa-plus"></i></button>
                <!-- Edit -->
                <button class="btn btnUtility " id="btnEdit" title="@appResource.ttEdit"><i class="fa fa-edit"></i></button>
            </div>

            <div class="btn-group m-2" role="group" aria-label="First group">
                <!-- PDF -->
                <button class="btn btnUtility btnPDF" title="@appResource.ttPDF"><i class="fa fa-file-pdf-o"></i></button>
                <!-- Excel -->
                <button class="btn btnUtility btnExcel btnDataTablePrint " title="@appResource.ttExcel"><i class="fa fa-file-excel-o"></i></button>
                <!-- Word -->
                <button class="btn btnUtility btnWord" id="btnWord" title="@appResource.ttWord"><i class="fa fa-file-word-o"></i></button>
            </div>


            <div class="btn-group m-2" role="group" aria-label="First group">
                <!-- Close -->
                <button class="btn btnUtility btnDeleteHead" title="@appResource.btnDelete"><i class="fa fa-close"></i></button>
            </div>

            <div class="btn-group m-2" role="group" aria-label="First group">
                <!-- Next -->
                <button class="btn btnUtility   btnFirst" id="btnFirst" title=" @appResource.ttFirst"><i class="fa  fa-fast-forward"></i></button>
                <!-- Prev -->
                <button class="btn btnUtility   btnNext" id="btnNext" title="@appResource.ttNext"><i class="fa  fa-forward "></i></button>
                <!-- First -->
                <button class="btn btnUtility btnPrev" id="btnPrev" title="@appResource.ttPrev"><i class="fa fa-backward"></i></button>
                <!-- Last -->
                <button class="btn btnUtility btnLast" id="btnLast" title="@appResource.ttLast"><i class="fa fa-fast-backward"></i></button>
            </div>


            <div class="btn-group m-2" role="group" aria-label="First group">
                <!-- Full Screen -->
                <button class="btn btnUtility btnFullScreen" title="@appResource.ttFullScreen"><i class="fa fa-window-maximize"></i></button>
            </div>

            <div class="btn-group m-2" role="group" aria-label="First group">
                <div class="dropdown">
                    <button class="btn btnUtility dropdown-toggle " type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fa fa-table"></i>
                    </button>
                    <div id="chkblackListdiv" class="flex-shrink-1 dropdown-menu" aria-labelledby="dropdownMenuButton"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="bg-white rounded border ">
    <table class="table table-bordered table-hover">
        <!--CashDesk-->
        <tr>
            <th></th>
            <th width="7%">
                رقم العميل
            </th>
            <th>اسم العميل - عربي </th>
            <th>اسم العميل - انجليزي </th>
            <th>ملاحظات</th>
            <th>القائمة السوداء</th>
            <th></th>
        </tr>
        <!--blackList-->
        <tbody class="tblblackListBody">
            <tr class="trBaseRow tblblackListRow" data-id="0">
                <td class="">
                    <button class="btn btn-light btn-sm border btnAddRow" type="submit">
                        <i class="fa fa-plus-circle"></i>
                    </button>
                </td>
                <td class="">
                    <input class="form-control form-control-sm text-center  txtCustomerId d-none" type="text" required />
                    <input class="form-control form-control-sm text-center  txtCustomerCode" type="text" required />
                </td>
                <td class="">
                    <input class="form-control form-control-sm text-center txtCustomerNameL1" required disabled />
                </td>
                <td class="">
                    <input class="form-control form-control-sm text-center txtCustomerNameL2" required disabled />
                </td>


                <td class="">
                    <input class="form-control form-control-sm text-center txtNotes" required />
                </td>
                <td width="7%" class="" style=" padding-right:5rem !important;">
                    <div class="custom-control custom-checkbox ">
                        <input type="checkbox" class="custom-control-input  chkIsBlackList " id="chkIsBlackList">
                        <label class="custom-control-label small" for="chkIsBlackList"></label>
                    </div>
                </td>
                <td><button class="btn btn-light btn-sm btnblackListDelete"><i class="fa fa-trash"></i></button></td>
            </tr>

        </tbody>
    </table>
    <div class="row  pt-5">
        <div class="col-md-6">
            <table class="table table-bordered table-hover">
                <!--CashDesk-->
                <tr>
                    <th></th>
                    <th>ملاحظات</th>
                    <th>الموقع</th>
                    <th></th>
                </tr>
                <!--blackList-->
                <tbody class="">
                    <tr class="trBaseRow " data-id="0">
                        <td class="">
                            <button class="btn btn-light btn-sm border btnAddRow" type="submit">
                                <i class="fa fa-plus-circle"></i>
                            </button>
                        </td>
                        <td class="">
                            <input class="form-control form-control-sm text-center  " type="text" required />
                        </td>
                        <td class="">
                            <input class="form-control form-control-sm text-center txtCustomerNameL1" required disabled />
                        </td>

                        <td><button class="btn btn-light btn-sm btnblackListDelete"><i class="fa fa-trash"></i></button></td>
                    </tr>
                    <tr class="trBaseRow tblblackListRow" data-id="0">
                        <td class="">
                            <button class="btn btn-light btn-sm border btnAddRow" type="submit">
                                <i class="fa fa-plus-circle"></i>
                            </button>
                        </td>
                        <td class="">
                            <input class="form-control form-control-sm text-center  txtblackListDtlName" type="text" required />
                        </td>
                        <td class="">
                            <input class="form-control form-control-sm text-center txtNotes" required disabled />
                        </td>

                        <td><button class="btn btn-light btn-sm btnblackListDelete"><i class="fa fa-trash"></i></button></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="col-md-6">
            <table class="table table-bordered table-hover">
                <!--CashDesk-->
                <tr>
                    <th></th>
                    <th>بيان التواصل</th>
                    <th>نوع التواصل</th>
                    <th></th>
                </tr>
                <!--blackList-->
                <tbody class="">
                    <tr class="trBaseRow " data-id="0">
                        <td class="">
                            <button class="btn btn-light btn-sm border btnAddRow" type="submit">
                                <i class="fa fa-plus-circle"></i>
                            </button>
                        </td>
                        <td class="">
                            <input class="form-control form-control-sm text-center  txtblackListDtlName" type="text" required />
                        </td>
                        <td class="">
                            <input class="form-control form-control-sm text-center txtNotes" required disabled />
                        </td>

                        <td><button class="btn btn-light btn-sm btnblackListDelete"><i class="fa fa-trash"></i></button></td>
                    </tr>
                    <tr class="trBaseRow tblblackListRow" data-id="0">
                        <td class="">
                            <button class="btn btn-light btn-sm border btnAddRow" type="submit">
                                <i class="fa fa-plus-circle"></i>
                            </button>
                        </td>
                        <td class="">
                            <input class="form-control form-control-sm text-center  txtblackListDtlName" type="text" required />
                        </td>
                        <td class="">
                            <input class="form-control form-control-sm text-center txtNotes" required disabled />
                        </td>

                        <td><button class="btn btn-light btn-sm btnblackListDelete"><i class="fa fa-trash"></i></button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- AccountData Modal -->
    <div id="AccountDataModal" class="fade modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content" id="AccountDataModalContent"></div>
        </div>
    </div>
    <script>


        // Open Customer Supplier Modal
        $('body').on('keyup dblclick', '.txtCustomerCode', function (e) {

            // Table Row - Closest Row
            vTableRow = $(this).closest('tr');

            // F9 - Double Click
            if (e.keyCode == 120 || e.type == 'dblclick') {
                // Search Account
                var vURL = '/GLCustomer/SearchCustomerModal';
                // Load Content of Account Search
                $('#AccountDataModalContent').load(vURL);
                // Modal Show
                $('#AccountDataModal').modal('show');
                // Focus
                $('#AccountDataModal').on('shown.bs.modal', function () {
                    $('.txtSearch').focus();

                    // Select Account
                    $('body').on('click', '.divCSSelect', function () {

                        // Get Values
                        var vCSId = $(this).attr('data-id');
                        var vCSNameValue = $(this).find('.divCustomerName').text();
                        var vCSNameL2Value = $(this).find('.divCustomerNameL2').text();
                        var vCSCodeValue = $(this).find('.divCustomerNo').text();
                    

                        // Get CS Data
                        var vCSIdElement = vTableRow.find('.txtCustomerId');
                        var vCSCodeElement = vTableRow.find('.txtCustomerCode');
                        var vCSNameElement = vTableRow.find('.txtCustomerNameL1');
                        var vCSNameL2Element = vTableRow.find('.txtCustomerNameL2');
                       

                        // Set Value
                        vCSIdElement.val(vCSId);
                        vCSCodeElement.val(vCSCodeValue);
                        vCSNameElement.val(vCSNameValue);
                        vCSNameL2Element.val(vCSNameL2Value);
            
                        // Modal Show
                        $('#AccountDataModal').modal('hide');

                    })
                })
            }
        })
    </script>
    <!--Config -->
    <script>
        function funBlackListConfig(pBlackListRow)
        {
            // Checked
            var vIsBlackList = null;

            if (pBlackListRow.IsBlackList) {
                vIsBlackList = 'checked';
            }
            var vRowContent =
                '<tr class="trBaseRow tblblackListRow" data-id="'+ pBlackListRow.CustomerId +'">' +
                '<td class="" >' +
                '<button class="btn btn-light btn-sm border btnAddRow" type="submit">' +
                '<i class="fa fa-plus-circle"></i>' +
                '</button>' +
                '</td >' +
                '<td class="">' +
                '<input class="form-control form-control-sm text-center  txtCustomerId d-none" value="' + pBlackListRow.CustomerId+'" type="text" required />' +
                '<input class="form-control form-control-sm text-center  txtCustomerCode" value="' + pBlackListRow.CustomerCode +'" type="text" required />' +
                '</td>' +
                '<td class="">' +
                '<input class="form-control form-control-sm text-center txtCustomerNameL1" value="' + pBlackListRow.CustomerNameL1 +'" required disabled />' +
                '</td>' +
                '<td class="">' +
                '<input class="form-control form-control-sm text-center txtCustomerNameL2" value="' + pBlackListRow.CustomerNameL2 +'" required disabled />' +
                '</td>' +
                '<td class="">' +
                '<input class="form-control form-control-sm text-center txtNotes" value="' + pBlackListRow.Notes +'" required />' +
                '</td>' +
                '<td width="7%" class="" style=" padding-right:5rem !important;">' +
                '<div class="custom-control custom-checkbox ">' +
                '<input type="checkbox" class="custom-control-input  chkIsBlackList" id="chkIsBlackList' + pBlackListRow.CustomerId + '" ' + vIsBlackList + '>' +
                '<label class="custom-control-label small" for="chkIsBlackList' + pBlackListRow.CustomerId + '"></label>' +
                '</div>' +
                '</td>' +
                '<td><button class="btn btn-light btn-sm btnblackListDelete"><i class="fa fa-trash"></i></button></td>' +
                '</tr>';

            return vRowContent;

        }

        // Add Row - Button Click
        $('body').on('click', '.btnAddRow', function () {
            // Add Row
            funAddInvDTLEmptyRow($('.tblblackListBody'));
        })


        // Add New Empty Cash Row
        function funAddInvDTLEmptyRow(pTableBody) {
            var vRowContent = {
                'CustomerId': '0',
                'CustomerCode': '',
                'CustomerNameL1': '',
                'CustomerNameL2': '',
                'Notes': '',
            }
            var vData = funBlackListConfig(vRowContent)
            pTableBody.append(vData)
        }

        LoadCustomerBlackList()
        // Load Customer
        function LoadCustomerBlackList() {

            $.get('/api/APIGLCustomer/GLCustomerGET',
                {
                    pIsCustomer: true,
                    // Query Type Id
                    pQueryTypeId: '410',

                }, function (data, status) {

                    // JSON
                    var vDataResult = JSON.parse(data);
                    // Table Body
                    var vTableBody = $('.tblblackListBody');

                    vTableBody.html('')
                    // Customers
                    $.each(vDataResult, function (i, CustomerData) {

                        console.log(CustomerData)

                        // GET Cash Desk Row Content
                        var vContent = funBlackListConfig(CustomerData);

                        // Append Row Content
                        $('.tblblackListBody').append(vContent);
                    })
        });
        }
        </script>
<!--Save-->
<script>
    // Save
    $('.btnSave').on('click', function () {
        funSaveAll();

    }) // End BtnSave

    // Save Using F10
    $('body').on('keyup', function (e) {
        // Check F10
        if (e.keyCode == 121) {
            // Save  ALL
            funSaveAll()
        }
    })

    function funSaveAll()
    {
        $('.tblblackListRow').each(function () {
            var vELement = $(this).closest('tr')

            var CustomerId = vELement.find('.txtCustomerId').val()
            var Notes = vELement.find('.txtNotes').val()
            var ChkIsBlackList = $(this).find('.chkIsBlackList').prop('checked')
          
            
            $.post('/GLSupplier/SaveHeader', {
                pCustomerId: CustomerId,
                pIsBlackList: ChkIsBlackList,
                pNotes: Notes,
                pQueryTypeId: 200
            }, function (data, status) {
          
            })

        })
        LoadCustomerBlackList()
        funNotification('تم الحفظ بنجاح', '1')
    }
</script>